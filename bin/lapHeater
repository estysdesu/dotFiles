#!/usr/bin/env bash

if [ "$(id -u)" -ne 0 ]; then
		echo 'This script must be run as root' >&2
		exit 1
fi

TEMP_MED=90
TEMP_HOT=120
DEG_SYM=$'\xc2\xb0'
NO_COL="$(tput sgr0)"
RED_COL="$(tput setaf 1)"
GREEN_COL="$(tput setaf 2)"
YEL_COL="$(tput setaf 3)"
BLUE_COL="$(tput setaf 4)"


while true; do
		OUT="$(powermetrics -n 1 -i 1 | grep -e 'CPU die temperature:*' -e 'Fan:*' | awk -F ': ' '{print $2}' | grep -o '[0-9\.]\+')" # last grep fails to capture
		FAN="$(echo $OUT | awk '{print 1}')"
		TEMP="$(echo $OUT | awk '{print 2}')"

		#### HERE #####
	# read -a == readarry w/ delim as space; <<< redirect sends string
	read -d' ' -a outArr <<< "$out"

	# use bash built in basic calculator for comparison of floats
	if (( $(echo "${outArr[1]} > ${bad}" | bc -l) )) ; then
		color=${red}
	elif (( $(echo "${outArr[1]} > ${warning}" | bc -l) )); then
		color=${yellow}
	else
		color=${blue}
	fi

printf "\033[1A"  # move cursor one line up
printf "\033[K"


    printf "CPU TEMP:\t${COLOR}${outArr[1]}*C
	printf "${color}CPU temp: ${outArr[1]}*C${nc}\t\t\t\n${color}Fan: ${outArr[0]}rpm${nc}\r"
done
